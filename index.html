<!doctype html>
<html lang="en" data-gh-owner="NikoRoberts" data-gh-repo="recipes" data-gh-path="" class="dark">
<head>
  <meta charset="utf-8" />
  <title>Recipes ‚Äî Markdown Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: {
              DEFAULT: '#3b82f6',
              dark: '#2563eb'
            }
          }
        }
      }
    }
  </script>
  <style>
    /* Custom transitions for sidebar */
    #sidebar {
      transition: transform 0.3s ease;
    }
    /* Ensure sidebar is visible on desktop */
    @media (min-width: 768px) {
      #sidebar {
        display: block !important;
        transform: none !important;
      }
    }
    #sidebar-overlay {
      transition: opacity 0.3s ease;
    }
    /* Hide overlay on desktop */
    @media (min-width: 768px) {
      #sidebar-overlay {
        display: none !important;
      }
    }
    /* Markdown content styling */
    #content h1 {
      font-size: 1.875rem !important;
      font-weight: 700 !important;
      margin-top: 1.5rem !important;
      margin-bottom: 1rem !important;
      line-height: 1.2 !important;
    }
    #content h2 {
      font-size: 1.5rem !important;
      font-weight: 700 !important;
      margin-top: 1.25rem !important;
      margin-bottom: 0.75rem !important;
      line-height: 1.3 !important;
    }
    #content h3 {
      font-size: 1.25rem !important;
      font-weight: 600 !important;
      margin-top: 1rem !important;
      margin-bottom: 0.5rem !important;
      line-height: 1.4 !important;
    }
    #content h4 {
      font-size: 1.125rem !important;
      font-weight: 600 !important;
      margin-top: 0.75rem !important;
      margin-bottom: 0.5rem !important;
    }
    #content h5 {
      font-size: 1rem !important;
      font-weight: 600 !important;
      margin-top: 0.5rem !important;
      margin-bottom: 0.5rem !important;
    }
    #content h6 {
      font-size: 0.875rem !important;
      font-weight: 600 !important;
      margin-top: 0.5rem !important;
      margin-bottom: 0.5rem !important;
    }
    #content p {
      margin-bottom: 1rem;
    }
    #content ul, #content ol {
      margin-bottom: 1rem;
      margin-left: 1.5rem;
    }
    #content ul {
      list-style-type: disc;
    }
    #content ol {
      list-style-type: decimal;
    }
    #content li {
      margin-bottom: 0.5rem;
    }
    #content a {
      color: #3b82f6;
      text-decoration: underline;
    }
    #content a:hover {
      color: #2563eb;
    }
    .dark #content a {
      color: #60a5fa;
    }
    .dark #content a:hover {
      color: #93c5fd;
    }
    #content code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: 0.875rem;
      background-color: #f3f4f6;
      padding: 0.125rem 0.25rem;
      border-radius: 0.25rem;
    }
    .dark #content code {
      background-color: #1f2937;
    }
    #content pre {
      background-color: #f9fafb;
      padding: 1rem;
      border-radius: 0.5rem;
      overflow: auto;
      border: 1px solid #e5e7eb;
      margin-bottom: 1rem;
    }
    .dark #content pre {
      background-color: #111827;
      border-color: #374151;
    }
    #content pre code {
      background-color: transparent;
      padding: 0;
    }
    #content blockquote {
      border-left: 4px solid #d1d5db;
      padding-left: 1rem;
      font-style: italic;
      margin: 1rem 0;
    }
    .dark #content blockquote {
      border-color: #4b5563;
    }
    #content table {
      width: 100%;
      margin-bottom: 1rem;
      border-collapse: collapse;
    }
    #content th, #content td {
      border: 1px solid #d1d5db;
      padding: 0.5rem 1rem;
    }
    .dark #content th, .dark #content td {
      border-color: #374151;
    }
    #content th {
      background-color: #f3f4f6;
      font-weight: 600;
    }
    .dark #content th {
      background-color: #1f2937;
    }
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css" media="(prefers-color-scheme: dark)">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css" media="(prefers-color-scheme: light)">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/nosleep.js@0.12.0/dist/NoSleep.min.js"></script>
</head>
<body class="bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100 min-h-screen grid grid-cols-[280px_1fr] max-md:grid-cols-1">
  <header class="col-span-full sticky top-0 z-20 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md border-b border-gray-200 dark:border-gray-800 px-4 py-3 flex items-center gap-3">
    <button id="menu-toggle" class="md:hidden text-2xl p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition" aria-label="Toggle menu">
      ‚ò∞
    </button>
    <h1 class="text-lg font-semibold text-gray-600 dark:text-gray-400">üç≥ Recipes</h1>
  </header>

  <div id="sidebar-overlay" class="fixed inset-0 top-[57px] bg-black/50 z-10 hidden opacity-0"></div>

  <aside id="sidebar" class="border-r border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-900 p-3 overflow-auto max-md:fixed max-md:top-[57px] max-md:left-0 max-md:bottom-0 max-md:w-72 max-md:-translate-x-full max-md:z-10">
    <div id="meta" class="text-xs text-gray-500 dark:text-gray-400 mb-3 px-2">Loading file list‚Ä¶</div>
    <div id="err" class="text-red-500 text-sm mt-2 px-2 hidden"></div>
    <ul id="files" class="space-y-1"></ul>
  </aside>

  <main class="p-4 overflow-auto">
    <div class="max-w-4xl mx-auto">
      <div id="toolbar" class="flex gap-2 flex-wrap items-center mb-4">
        <button id="toggle-wake" class="px-4 py-2 rounded-full border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-sm font-medium">
          Keep Screen Awake
        </button>
        <button id="dark-mode-toggle" class="px-4 py-2 rounded-full border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition text-sm font-medium">
          <span class="dark:hidden">üåô Dark</span>
          <span class="hidden dark:inline">‚òÄÔ∏è Light</span>
        </button>
        <span id="status" class="text-xs text-gray-500 dark:text-gray-400"></span>
      </div>
      <article id="content" class="prose dark:prose-invert max-w-none">
        <p class="text-gray-500 dark:text-gray-400">Select a markdown file from the sidebar.</p>
      </article>
    </div>
  </main>

  <script>
    function parseGitHubPagesLocation() {
      const host = location.hostname;
      const pathParts = location.pathname.replace(/^\/+/, '').split('/');
      let owner=null, repo=null, path='';
      const m = host.match(/^(.+)\.github\.io$/i);
      if (m) { owner = m[1]; repo = pathParts[0]||''; path = pathParts.slice(1).join('/'); }
      else { repo = pathParts[0]||''; path = pathParts.slice(1).join('/'); }
      if (path && /\.[A-Za-z0-9]+$/.test(path.split('/').pop())) path = path.split('/').slice(0,-1).join('/');
      return { owner, repo, path };
    }
    function getOwnerRepoPath() {
      const html = document.documentElement;
      const overrideOwner = html.dataset.ghOwner || null;
      const overrideRepo  = html.dataset.ghRepo  || null;
      const overridePath  = html.dataset.ghPath  || null;
      const inferred = parseGitHubPagesLocation();
      return {
        owner: overrideOwner || inferred.owner,
        repo:  overrideRepo  || inferred.repo,
        path:  overridePath  || inferred.path
      };
    }
    const mdExtensions = ['.md','.markdown','.mdown','.mkd','.mkdn'];
    const isMarkdown = (n)=>mdExtensions.some(ext=>n.toLowerCase().endsWith(ext));

    // Dark mode toggle
    const darkModeToggle = document.getElementById('dark-mode-toggle');
    const htmlEl = document.documentElement;

    // Initialize from localStorage or system preference
    if (!localStorage.getItem('theme')) {
      localStorage.setItem('theme', 'dark');
    }
    if (localStorage.getItem('theme') === 'light') {
      htmlEl.classList.remove('dark');
    }

    darkModeToggle.addEventListener('click', () => {
      htmlEl.classList.toggle('dark');
      localStorage.setItem('theme', htmlEl.classList.contains('dark') ? 'dark' : 'light');
    });

    // Wake Lock + NoSleep fallback
    let wakeLock=null, wakeEnabled=false, noSleep=null;

    function updateWakeButton() {
      const btn = document.getElementById('toggle-wake');
      if (wakeEnabled) {
        btn.classList.add('ring-2', 'ring-blue-500', 'bg-blue-50', 'dark:bg-blue-950');
      } else {
        btn.classList.remove('ring-2', 'ring-blue-500', 'bg-blue-50', 'dark:bg-blue-950');
      }
    }

    async function requestWakeLock(){
      const status = document.getElementById('status');
      try {
        if ('wakeLock' in navigator) {
          wakeLock = await navigator.wakeLock.request('screen');
          wakeEnabled = true;
          status.textContent='Screen wake lock active.';
          wakeLock.addEventListener('release',()=>{
            wakeEnabled=false;
            status.textContent='Wake lock released.';
            updateWakeButton();
          });
        } else {
          if (!noSleep) noSleep = new NoSleep();
          noSleep.enable();
          wakeEnabled = true;
          status.textContent='Wake lock (fallback) enabled.';
        }
        updateWakeButton();
      } catch(e){
        status.textContent='Wake lock unavailable: '+e.message;
        wakeEnabled=false;
        updateWakeButton();
      }
    }

    function releaseWakeLock(){
      const status = document.getElementById('status');
      if (wakeLock) { wakeLock.release(); wakeLock=null; }
      if (noSleep) { try{ noSleep.disable(); }catch{} }
      wakeEnabled=false;
      status.textContent='Wake lock disabled.';
      updateWakeButton();
    }

    document.getElementById('toggle-wake').addEventListener('click', async function() {
      if (!wakeEnabled) {
        await requestWakeLock();
      } else {
        releaseWakeLock();
      }
    });

    document.addEventListener('visibilitychange', async ()=> {
      if (document.visibilityState==='visible' && wakeEnabled && 'wakeLock' in navigator) {
        await requestWakeLock();
      }
    });

    // Mobile menu toggle
    const menuToggle = document.getElementById('menu-toggle');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');

    function isMobile() {
      return window.innerWidth < 768;
    }

    function toggleSidebar() {
      if (!isMobile()) return; // Only toggle on mobile

      const isOpen = sidebar.classList.contains('max-md:translate-x-0');

      if (isOpen) {
        sidebar.classList.remove('max-md:translate-x-0');
        sidebarOverlay.classList.remove('opacity-100');
        setTimeout(() => sidebarOverlay.classList.add('hidden'), 300);
      } else {
        sidebar.classList.add('max-md:translate-x-0');
        sidebarOverlay.classList.remove('hidden');
        setTimeout(() => sidebarOverlay.classList.add('opacity-100'), 10);
      }
    }

    function closeSidebar() {
      if (!isMobile()) return; // Only close on mobile

      sidebar.classList.remove('max-md:translate-x-0');
      sidebarOverlay.classList.remove('opacity-100');
      setTimeout(() => sidebarOverlay.classList.add('hidden'), 300);
    }

    menuToggle.addEventListener('click', toggleSidebar);
    sidebarOverlay.addEventListener('click', closeSidebar);

    // Close sidebar when selecting a file on mobile
    document.addEventListener('click', (e)=> {
      if (e.target.matches('#files button') && isMobile()) {
        closeSidebar();
      }
    });

    // marked + highlight.js - wait for libraries to load
    let librariesReady = false;
    window.addEventListener('load', ()=> {
      if (window.marked && window.DOMPurify) {
        librariesReady = true;
        if (window.hljs) {
          marked.setOptions({
            highlight: (code, lang) => {
              try {
                if (lang && hljs.getLanguage(lang)) return hljs.highlight(code,{language:lang}).value;
                return hljs.highlightAuto(code).value;
              } catch { return code; }
            }
          });
        }
      }
    });

    const renderMarkdown = (md)=> {
      if (!window.marked || !window.DOMPurify) {
        return '<p class="text-red-500">Error: Markdown libraries not loaded</p>';
      }
      try {
        return DOMPurify.sanitize(marked.parse(md), {USE_PROFILES:{html:true, svg:true}});
      } catch(e) {
        return `<p class="text-red-500">Error rendering markdown: ${e.message}</p>`;
      }
    };

    function setError(msg){
      const err = document.getElementById('err');
      err.textContent = msg;
      err.classList.remove('hidden');
    }

    async function fetchDirectory(){
      const {owner, repo, path} = getOwnerRepoPath();
      const meta = document.getElementById('meta');
      const filesList = document.getElementById('files');

      if (!owner || !repo) { meta.textContent='Could not infer owner/repo.'; return []; }

      const base = `https://api.github.com/repos/${owner}/${repo}/contents`;
      const api  = path ? `${base}/${encodeURIComponent(path)}` : base;

      meta.textContent = `üìÇ ${owner}/${repo}${path ? '/'+path : ''}`;
      try {
        const res = await fetch(api, { headers: {'Accept':'application/vnd.github+json'} });
        if (!res.ok) throw new Error(`GitHub API ${res.status}`);
        const items = await res.json();
        const files = (Array.isArray(items)?items:[]).filter(it => it.type==='file' && isMarkdown(it.name));
        files.sort((a,b)=>a.name.localeCompare(b.name, undefined, {sensitivity:'base'}));
        filesList.innerHTML='';
        if (!files.length) {
          filesList.innerHTML='<li class="text-gray-500 dark:text-gray-400 text-sm px-2">No Markdown files in this folder.</li>';
        } else {
          for (const f of files) {
            const li=document.createElement('li');
            const btn=document.createElement('button');
            btn.textContent=f.name.replace(/\.md$/, '');
            btn.className='w-full text-left px-3 py-2.5 rounded-lg border border-transparent hover:border-gray-300 dark:hover:border-gray-700 hover:bg-white dark:hover:bg-gray-800 transition text-sm truncate';
            btn.dataset.downloadUrl=f.download_url;
            btn.dataset.path=f.path;
            btn.addEventListener('click', ()=> loadFile(f.name, f.download_url, btn));
            li.appendChild(btn); filesList.appendChild(li);
          }
        }
        return files;
      } catch(e){
        meta.textContent='Error fetching list.';
        setError('Directory load failed: '+e.message+' ‚Äî is the repo public and Pages enabled?');
        return [];
      }
    }

    async function loadFile(name, url, btn){
      const contentEl = document.getElementById('content');
      document.querySelectorAll('#files button').forEach(b=>{
        b.classList.remove('bg-blue-50', 'dark:bg-blue-950', 'border-blue-500', 'dark:border-blue-600', 'font-semibold');
      });
      if (btn) {
        btn.classList.add('bg-blue-50', 'dark:bg-blue-950', 'border-blue-500', 'dark:border-blue-600', 'font-semibold');
      }
      contentEl.innerHTML = `<p class="text-gray-500 dark:text-gray-400">Loading <code>${name}</code>‚Ä¶</p>`;
      try {
        const res = await fetch(url, { cache:'no-store' });
        if (!res.ok) throw new Error(`Fetch ${res.status}`);
        const md = await res.text();
        contentEl.innerHTML = renderMarkdown(md);
        const params = new URLSearchParams(location.search); params.set('file', name);
        history.replaceState(null, '', `${location.pathname}?${params.toString()}`);
      } catch(e){
        contentEl.innerHTML = `<p class="text-red-500">Failed to load file: ${e.message}</p>`;
      }
    }

    async function waitForLibraries() {
      return new Promise((resolve) => {
        if (window.marked && window.DOMPurify) {
          resolve();
        } else {
          window.addEventListener('load', () => {
            resolve();
          });
        }
      });
    }

    (async function init(){
      await waitForLibraries();
      const files = await fetchDirectory();
      const qp = new URLSearchParams(location.search); const wanted = qp.get('file');
      if (wanted && files.length) {
        const match = files.find(f=>f.name===wanted);
        if (match) {
          const btn=[...document.querySelectorAll('#files button')].find(b=>b.textContent===wanted.replace(/\.md$/, ''));
          loadFile(match.name, match.download_url, btn); return;
        }
      }
      if (files.length) { const first=files[0]; const btn=document.querySelector('#files button'); loadFile(first.name, first.download_url, btn); }
    })();
  </script>
</body>
</html>
